From 56fba1c5c15dbe8a25bfccaec75d2b24c1ccae91 Mon Sep 17 00:00:00 2001
From: Dominggoes Isakh <drjisakh@gmail.com>
Date: Wed, 20 Aug 2025 05:36:32 -0400
Subject: [PATCH 3/4] gts2-common: Add persistent logging support

Change-Id: Ic977af83bf3524887b2bcc73a830953e4398be50
---
 rootdir/etc/init.universal5433.rc | 12 ++++++++++++
 sepolicy/vendor/logpersist.te     |  3 ++-
 2 files changed, 14 insertions(+), 1 deletion(-)

diff --git a/rootdir/etc/init.universal5433.rc b/rootdir/etc/init.universal5433.rc
index b56ced7..6e9b2ac 100644
--- a/rootdir/etc/init.universal5433.rc
+++ b/rootdir/etc/init.universal5433.rc
@@ -62,6 +62,9 @@ on init
 on post-fs-data
     mkdir /data/media 0770 media_rw media_rw
 
+    # Persistent logcat
+    mkdir /data/.logs 0775 system system
+
     setprop vold.post_fs_data_done 1
 
     # Permissions Camera
@@ -635,3 +638,12 @@ service argos-daemon /vendor/bin/argosd
     class main
     user system
     group system radio
+
+service persistentLogging /system/bin/logcat -r 1024 -n 9 -f /data/.logs/log
+    class core
+    user system
+    group system
+    oneshot
+
+on property:persist.logcat.enabled=1
+    start persistentLogging
diff --git a/sepolicy/vendor/logpersist.te b/sepolicy/vendor/logpersist.te
index 94a8dd0..6aa335a 100644
--- a/sepolicy/vendor/logpersist.te
+++ b/sepolicy/vendor/logpersist.te
@@ -1,3 +1,4 @@
 #============= logpersist ==============
 allow logpersist vendor_file:file r_file_perms;
-
+allow logpersist system_data_file:dir { add_name open read write remove_name};
+allow logpersist system_data_file:file { ioctl write  append create open getattr read rename unlink };
-- 
2.45.2

