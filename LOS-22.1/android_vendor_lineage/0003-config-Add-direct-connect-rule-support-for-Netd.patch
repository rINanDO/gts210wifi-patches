From 0cd35ee2b99c1785b509a88b979627ab911b1ced Mon Sep 17 00:00:00 2001
From: Dominggoes Isakh <drjisakh@gmail.com>
Date: Sat, 5 Nov 2022 20:51:20 +0100
Subject: [PATCH 3/4] config: Add direct connect rule support for Netd

Change-Id: Ic09389f4356c819716ae21b899de24b2d1f5c4ec
Signed-off-by: Dominggoes Isakh <drjisakh@gmail.com>
---
 build/soong/Android.bp     | 18 ++++++++++++++++++
 config/BoardConfigSoong.mk |  3 +++
 2 files changed, 21 insertions(+)

diff --git a/build/soong/Android.bp b/build/soong/Android.bp
index 60402c02..2ed80651 100644
--- a/build/soong/Android.bp
+++ b/build/soong/Android.bp
@@ -487,3 +487,21 @@ has_memfd_backport {
         },
     },
 }
+
+// Netd direct connect rule
+soong_config_module_type {
+    name: "needs_netd_direct_connect_rule",
+    module_type: "cc_defaults",
+    config_namespace: "lineageGlobalVars",
+    bool_variables: ["needs_netd_direct_connect_rule"],
+    properties: ["cppflags"],
+}
+
+needs_netd_direct_connect_rule {
+    name: "needs_netd_direct_connect_rule_defaults",
+    soong_config_variables: {
+        needs_netd_direct_connect_rule: {
+            cppflags: ["-DNEEDS_NETD_DIRECT_CONNECT_RULE"],
+        },
+    },
+}
diff --git a/config/BoardConfigSoong.mk b/config/BoardConfigSoong.mk
index 6829220b..84a40917 100644
--- a/config/BoardConfigSoong.mk
+++ b/config/BoardConfigSoong.mk
@@ -137,3 +137,6 @@ else
 SOONG_CONFIG_lineageQcomVars_qcom_display_headers_namespace := $(QCOM_SOONG_NAMESPACE)/display
 endif
 SOONG_CONFIG_lineageQcomVars_qti_vibrator_effect_lib := $(TARGET_QTI_VIBRATOR_EFFECT_LIB)
+
+SOONG_CONFIG_lineageGlobalVars += needs_netd_direct_connect_rule
+SOONG_CONFIG_lineageGlobalVars_needs_netd_direct_connect_rule := $(TARGET_NEEDS_NETD_DIRECT_CONNECT_RULE)
-- 
2.45.2

