From 866cd98da6509eba199a07e6829f08afb4ecb2fa Mon Sep 17 00:00:00 2001
From: html6405 <peter.schelchshorn@mhs-solutions.at>
Date: Mon, 25 Dec 2023 20:49:17 +0100
Subject: [PATCH 08/10] Revert "Rewrite renameat()."

We still want to support kernels without renameat2

This reverts commit 6660d6c00b2253a941aaa3fcd01ead885327b3b5.
---
 libc/SYSCALLS.TXT      | 1 +
 libc/bionic/rename.cpp | 6 +-----
 2 files changed, 2 insertions(+), 5 deletions(-)

diff --git a/libc/SYSCALLS.TXT b/libc/SYSCALLS.TXT
index 8c5572eb3..fd9cffdfb 100644
--- a/libc/SYSCALLS.TXT
+++ b/libc/SYSCALLS.TXT
@@ -161,6 +161,7 @@ int linkat(int, const char*, int, const char*, int)  all
 int mkdirat(int, const char*, mode_t)  all
 int mknodat(int, const char*, mode_t, dev_t)  all
 ssize_t readlinkat(int, const char*, char*, size_t)  all
+int renameat(int, const char*, int, const char*)  all
 int renameat2(int, const char*, int, const char*, unsigned)  all
 int symlinkat(const char*, int, const char*)  all
 int unlinkat(int, const char*, int)   all
diff --git a/libc/bionic/rename.cpp b/libc/bionic/rename.cpp
index 89786f7a0..82955596b 100644
--- a/libc/bionic/rename.cpp
+++ b/libc/bionic/rename.cpp
@@ -30,9 +30,5 @@
 #include <stdio.h>
 
 int rename(const char* old_path, const char* new_path) {
-  return renameat2(AT_FDCWD, old_path, AT_FDCWD, new_path, 0);
-}
-
-int renameat(int old_dir_fd, const char* old_path, int new_dir_fd, const char* new_path) {
-  return renameat2(old_dir_fd, old_path, new_dir_fd, new_path, 0);
+  return renameat(AT_FDCWD, old_path, AT_FDCWD, new_path);
 }
-- 
2.45.2

